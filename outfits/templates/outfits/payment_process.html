{% extends 'outfits/base.html' %}
{% load humanize %}
{% load static %}

{% block title %}Submit Payment - Order #{{ order.id }}{% endblock %}

{% block content %}
<div style="max-width: 750px; margin: 20px auto;">
    <h1 style="text-align: center; margin-bottom: 20px;">Submit Payment Proof</h1>
    <p style="text-align: center; margin-bottom: 25px;">For Rental Order: <strong>#{{ order.id }}</strong></p>

    {% if messages %}
       <div class="messages-container" style="padding-bottom: 15px;">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

{% if order.status == 'pending' %}
<div class="payment-container">
  <div class="bank-details">
    <h3>Payment Details</h3>
    <p class="total-amount">Amount Due: {{ order.total_amount|floatformat:2|intcomma }}</p>
    <p><strong>Bank:</strong> {{ bank_details.bank_name }}</p>
    <p><strong>Account Name:</strong> {{ bank_details.account_name }}</p>
    <p><strong>Account Number:</strong> {{ bank_details.account_number }}</p>

    {% if bank_details.qr_code_path %}
    <div class="bank-qr">
        <p style="text-align: center; font-size: 0.9em; color: var(--text-light-color);">Scan QR Code to Pay:</p>
        <img src="{% static bank_details.qr_code_path %}" alt="Bank QR Code">
    </div>
    {% endif %}
  </div>

  <div class="slip-upload">
    <h3>Upload Payment Slip</h3>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {% for field in form %}
            <div class="form-field">
                {{ field.label_tag }}
                {{ field }}
                {% if field.errors %}<div class="form-errors">{{ field.errors }}</div>{% endif %}
                {% if field.help_text %}<p class="help-text">{{ field.help_text|safe }}</p>{% endif %}
            </div>
        {% endfor %}
        <button type="submit" class="button primary-button" style="width: 100%; padding: 10px; margin-top: 10px;">Confirm Payment Submission</button>
    </form>
  </div>
</div>
{% else %}
<div style="text-align: center; padding: 30px; max-width: 600px; margin: 20px auto;" class="detail-card">
    {% if order.status == 'waiting_for_approval' %}
        <p>Your payment for Order #{{ order.id }} is currently awaiting approval.</p>
    {% elif order.status == 'failed' %}
         <p class="alert alert-danger">Payment for Order #{{ order.id }} was unsuccessful or the slip was incorrect.</p>
         {% if order.admin_payment_note %}<p>Admin Note: {{ order.admin_payment_note }}</p>{% endif %}
         <p style="margin-top: 15px;">Please contact support or try submitting payment again if applicable.</p>
    {% else %}
         <p>Payment for Order #{{ order.id }} cannot be submitted at this time (Status: {{ order.get_status_display }}).</p>
    {% endif %}
     <p style="margin-top: 20px;"><a href="{% url 'outfits:order_detail' order.id %}" class="button secondary-button">View Order Details</a></p>
</div>
{% endif %}

{% endblock %}