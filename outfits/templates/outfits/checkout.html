{% extends 'outfits/base.html' %}
{% load humanize %}

{% block title %}Checkout - ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤{% endblock %}

{% block extra_head %}
{# ... (‡∏™‡πà‡∏ß‡∏ô style ‡πÄ‡∏î‡∏¥‡∏°) ... #}
<style>
  /* ... (CSS ‡πÄ‡∏î‡∏¥‡∏°) ... */
  .calculated-duration {
      font-weight: bold;
      color: var(--primary-color);
      margin-left: 10px; /* Adjust spacing */
  }
</style>
{% endblock %}

{% block content %}
<div class="checkout-container" style="max-width: 1100px; margin: 20px auto; padding: 15px;">
  <h1 style="text-align: center; margin-bottom: 25px; color: var(--primary-color);">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤</h1>

  {# ... (‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á Messages ‡πÅ‡∏•‡∏∞ Errors ‡πÄ‡∏î‡∏¥‡∏°) ... #}

  <div class="checkout-grid">
    <div class="form-section">
      <h2 style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤</h2>
      <form method="post" class="checkout-form">
        {% csrf_token %}

        {% for field in form %}
        <div class="form-field">
            {{ field.label_tag }}
            {{ field }} {# Render field ‡πÅ‡∏•‡∏∞ widget ‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô #}

            {# --- ‡πÄ‡∏û‡∏¥‡πà‡∏° span ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô field ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà --- #}
            {% if field.name == 'rental_end_date' %}
                <span id="rental-duration-display" class="calculated-duration"></span>
            {% endif %}
            {# --- ‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° span --- #}

            {% if field.errors %}
                {# ... (‡πÅ‡∏™‡∏î‡∏á errors ‡πÄ‡∏î‡∏¥‡∏°) ... #}
            {% endif %}
            {% if field.help_text %}
                 {# ... (‡πÅ‡∏™‡∏î‡∏á help text ‡πÄ‡∏î‡∏¥‡∏°) ... #}
            {% endif %}
        </div>
        {% endfor %}

        <button type="submit" class="button primary-button" style="width: 100%; padding: 12px; font-size: 1.1em; margin-top: 20px;">
          ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
        </button>
      </form>
    </div>

    {# ... (‡∏™‡πà‡∏ß‡∏ô Summary Section ‡πÄ‡∏î‡∏¥‡∏°) ... #}

  </div>
</div>

{% endblock %}

{% block extra_js %} {# --- ‡πÄ‡∏û‡∏¥‡πà‡∏° Block ‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö JavaScript ‡∏ó‡πâ‡∏≤‡∏¢ Body --- #}
<script>
  document.addEventListener('DOMContentLoaded', function() {
      const startDateInput = document.getElementById('{{ form.rental_start_date.id_for_label }}'); // ‡πÉ‡∏ä‡πâ id ‡∏à‡∏≤‡∏Å form
      const endDateInput = document.getElementById('{{ form.rental_end_date.id_for_label }}'); // ‡πÉ‡∏ä‡πâ id ‡∏à‡∏≤‡∏Å form
      const durationDisplay = document.getElementById('rental-duration-display');

      function calculateDuration() {
          const startDateStr = startDateInput.value;
          const endDateStr = endDateInput.value;

          if (startDateStr && endDateStr && durationDisplay) {
              const startDate = new Date(startDateStr);
              const endDate = new Date(endDateStr);

              // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
              if (!isNaN(startDate) && !isNaN(endDate) && endDate >= startDate) {
                  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                  const diffTime = Math.abs(endDate - startDate);
                  // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô (1000 * 60 * 60 * 24) ‡πÅ‡∏•‡∏∞‡∏ö‡∏ß‡∏Å 1 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ô‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å
                  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                  durationDisplay.textContent = `(${diffDays} ‡∏ß‡∏±‡∏ô)`;
              } else {
                  durationDisplay.textContent = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
              }
          } else if (durationDisplay) {
               durationDisplay.textContent = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πâ‡∏≤ input ‡∏ß‡πà‡∏≤‡∏á
          }
      }

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
      if (startDateInput) startDateInput.addEventListener('change', calculateDuration);
      if (endDateInput) endDateInput.addEventListener('change', calculateDuration);

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ initial)
      calculateDuration();
  });
</script>
{% endblock %}