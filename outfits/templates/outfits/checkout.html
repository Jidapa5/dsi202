{% extends 'outfits/base.html' %}
{% load humanize %}

{% block title %}Checkout - ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤{% endblock %}

{% block extra_head %}
{# ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS/JS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Date Picker (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£) #}
{# <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"> #}
{# <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script> #}
<style>
  .checkout-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
  .form-section, .summary-section { background-color: white; padding: 25px; border-radius: var(--border-radius); box-shadow: var(--shadow); }
  .form-field p { margin-bottom: 15px; }
  .form-field label { display: block; margin-bottom: 5px; font-weight: 500; }
  .form-input, .form-textarea, .form-date {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
  }
   .form-textarea { resize: vertical; min-height: 80px;}
  .form-errors { color: #dc3545; font-size: 0.9em; margin-top: 5px;}
  .summary-section ul { list-style: none; padding: 0; margin-bottom: 15px; }
  .summary-section li { border-bottom: 1px dashed #eee; padding-bottom: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; }
  .total-row { font-weight: bold; border-top: 1px solid #ccc; padding-top: 10px; margin-top: 15px; font-size: 1.1em;}

  @media (max-width: 768px) {
    .checkout-grid { grid-template-columns: 1fr; }
  }
</style>
{% endblock %}

{% block content %}
<div class="checkout-container" style="max-width: 1100px; margin: 20px auto; padding: 15px;">
  <h1 style="text-align: center; margin-bottom: 25px; color: var(--primary-color);">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤</h1>

  {# --- ‡πÅ‡∏™‡∏î‡∏á Global Form Errors (‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∏‡∏î‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á) --- #}
  {% if form.non_field_errors %}
      <div class="alert alert-danger" role="alert">
          {% for error in form.non_field_errors %}
              <p>{{ error }}</p>
          {% endfor %}
      </div>
  {% endif %}
  {# --- ‡πÅ‡∏™‡∏î‡∏á Messages ‡∏à‡∏≤‡∏Å Views --- #}
   {% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" role="alert">
            {{ message }}
        </div>
    {% endfor %}
   {% endif %}


  <div class="checkout-grid">
    <div class="form-section">
      <h2 style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤</h2>
      <form method="post" class="checkout-form">
        {% csrf_token %}

        {# ‡πÅ‡∏™‡∏î‡∏á field errors ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞ field #}
        {% for field in form %}
        <div class="form-field">
            {{ field.label_tag }}
            {{ field }} {# Render field ‡πÅ‡∏•‡∏∞ widget ‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô #}
            {% if field.errors %}
                <div class="form-errors">
                    {% for error in field.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
            {% if field.help_text %}
                 <p class="help-text" style="font-size: 0.85em; color: grey; margin-top: 3px;">{{ field.help_text }}</p>
            {% endif %}
        </div>
        {% endfor %}

        {# --- ‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô Omise Token ‡∏≠‡∏≠‡∏Å --- #}

        <button type="submit" class="button primary-button" style="width: 100%; padding: 12px; font-size: 1.1em; margin-top: 20px;">
          ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
        </button>
      </form>
    </div>

    <div class="summary-section">
      <h2 style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">üßæ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
      {% if cart_items %}
        <ul>
          {% for item in cart_items %}
          <li>
            <span>{{ item.quantity }} x {{ item.outfit.name }}</span>
            <span style="color: grey;">({{ item.price_per_day|floatformat:2|intcomma }}/‡∏ß‡∏±‡∏ô)</span>
          </li>
          {% endfor %}
        </ul>
        <div class="total-row">
          <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô)</span>
          <span>{{ cart_subtotal_per_day|floatformat:2|intcomma }} ‡∏ö‡∏≤‡∏ó</span>
        </div>
        <p style="font-size: 0.9em; color: grey; margin-top: 15px;">
          *‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        </p>
      {% else %}
        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
        <a href="{% url 'outfits:outfit-list' %}">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î</a>
      {% endif %}
    </div>
  </div>
</div>

{# --- (Optional) Initialize Date Picker --- #}
{# <script>
  document.addEventListener('DOMContentLoaded', function() {
    flatpickr("input[type='date']", { // ‡πÉ‡∏ä‡πâ CSS selector ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å input date
      dateFormat: "Y-m-d", // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà Django ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á
      minDate: "today"     // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï
      // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° option ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô disable ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á
    });
  });
</script> #}

{% endblock %}