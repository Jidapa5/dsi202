{% extends 'outfits/base.html' %}
{% load humanize %} {# ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏î‡πâ‡∏ß‡∏¢ intcomma #}
{% load static %} {# ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ static file ‡∏≠‡∏∑‡πà‡∏ô‡πÜ #}

{% block title %}‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - MindVibe{% endblock %}

{% block content %}
<div class="cart-container" style="max-width: 960px; margin: 20px auto; padding: 15px;">
  <h1 style="text-align: center; margin-bottom: 25px; color: var(--primary-color);">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>

  {% if cart_items %}
    <div class="cart-table-container" style="overflow-x: auto;">
      <table class="cart-table" style="width: 100%; border-collapse: collapse; background-color: white; box-shadow: var(--shadow); border-radius: var(--border-radius); overflow: hidden;">
        <thead>
          <tr style="border-bottom: 2px solid #eee; background-color: #f8f9fa;">
            <th style="text-align: left; padding: 12px;">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
            <th style="text-align: left; padding: 12px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î</th>
            <th style="text-align: right; padding: 12px;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</th>
            <th style="text-align: center; padding: 12px;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th style="text-align: right; padding: 12px;">‡∏£‡∏ß‡∏° (‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô)</th>
            <th style="text-align: center; padding: 12px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody>
          {% for item in cart_items %}
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px;">
              {% if item.outfit.image %}
              <a href="{% url 'outfits:outfit-detail' item.outfit.pk %}">
                <img src="{{ item.outfit.image.url }}" alt="{{ item.outfit.name }}" style="height: 60px; width: auto; border-radius: 4px; object-fit: cover;">
              </a>
              {% else %}
              <div style="height: 60px; width: 50px; background-color: #eee; display: flex; align-items: center; justify-content: center; font-size: 0.8em; color: grey; border-radius: 4px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>
              {% endif %}
            </td>
            <td style="padding: 10px;">
              <a href="{% url 'outfits:outfit-detail' item.outfit.pk %}" style="color: var(--primary-color); text-decoration: none;">
                {{ item.outfit.name }}
              </a>
              {% if item.outfit.category %}
                <p style="font-size: 0.85em; color: grey; margin-top: 2px;">{{ item.outfit.category.name }}</p>
              {% endif %}
            </td>
            {# --- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô --- #}
            <td style="text-align: right; padding: 10px;">{{ item.price_per_day|floatformat:2|intcomma }}</td>
            <td style="text-align: center; padding: 10px;">
              {# --- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡πÉ‡∏ä‡πâ item.update_form --- #}
              <form method="post" action="{% url 'outfits:update_cart_item' item.outfit.id %}" style="display: flex; justify-content: center; align-items: center; gap: 5px;">
                {% csrf_token %}
                {{ item.update_form.quantity }} {# ‡πÉ‡∏ä‡πâ widget ‡∏à‡∏≤‡∏Å forms.py #}
                <button type="submit" class="button secondary-button tiny-button">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</button>
              </form>
            </td>
            {# --- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô) --- #}
            <td style="text-align: right; padding: 10px;">{{ item.item_subtotal|floatformat:2|intcomma }}</td>
            <td style="text-align: center; padding: 10px;">
              {# --- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --- #}
              <form method="post" action="{% url 'outfits:remove_from_cart' item.outfit.id %}">
                {% csrf_token %}
                <button type="submit" class="button alert-button tiny-button">‡∏•‡∏ö</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr style="background-color: #f8f9fa; font-weight: bold;">
            {# --- ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô) --- #}
            <td colspan="4" style="text-align: right; padding: 12px;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô):</td>
            <td colspan="2" style="text-align: right; padding: 12px; color: var(--primary-color); font-size: 1.1em;">{{ cart_subtotal_per_day|floatformat:2|intcomma }} ‡∏ö‡∏≤‡∏ó</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="cart-actions" style="margin-top: 25px; display: flex; justify-content: space-between; align-items: center;">
      <a href="{% url 'outfits:outfit-list' %}" class="button secondary-button">&larr; ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</a>
      {# --- ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Checkout --- #}
      <a href="{% url 'outfits:checkout' %}" class="button primary-button" style="font-size: 1.1em;">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ &rarr;</a>
    </div>
    <p style="text-align: right; margin-top: 10px; font-size: 0.9em; color: grey;">*‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>

  {% else %}
    <div style="text-align: center; padding: 40px; background-color: white; border-radius: var(--border-radius); box-shadow: var(--shadow);">
      <p style="font-size: 1.2em; color: grey; margin-bottom: 20px;">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>
      <a href="{% url 'outfits:outfit-list' %}" class="button primary-button">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡πÄ‡∏•‡∏¢!</a>
    </div>
  {% endif %}
</div>
{% endblock %}