{% extends 'outfits/base.html' %} {# หรือ base template ของคุณ #}
{% load humanize %} {# ถ้าใช้ใน settings.py #}

{% block title %}ตะกร้าสินค้า{% endblock %}

{% block content %}
<h1>ตะกร้าสินค้าของคุณ</h1>

{% if cart_items %}
    {# --- ใช้ CSS จัดการ layout table ให้ดีขึ้น แทน border="1" --- #}
    <table class="cart-table" style="width:100%; border-collapse: collapse; margin-bottom: 20px;">
        <thead>
            <tr style="border-bottom: 2px solid #ccc;">
                <th style="text-align: left; padding: 8px;">รูปภาพ</th>
                <th style="text-align: left; padding: 8px;">ชื่อชุด</th>
                <th style="text-align: right; padding: 8px;">ราคาต่อวัน</th>
                <th style="text-align: center; padding: 8px;">จำนวนชุด</th>
                <th style="text-align: right; padding: 8px;">ราคารวม (ต่อรายการ)</th>
                <th style="text-align: center; padding: 8px;">จัดการ</th>
            </tr>
        </thead>
        <tbody>
            {% for item in cart_items %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 8px;">
                    {% if item.outfit.image %}
                        <a href="{% url 'outfits:outfit-detail' item.outfit.pk %}">
                           <img src="{{ item.outfit.image.url }}" alt="{{ item.outfit.name }}" height="60">
                        </a>
                    {% else %}
                        (ไม่มีรูป)
                    {% endif %}
                </td>
                <td style="padding: 8px;"><a href="{% url 'outfits:outfit-detail' item.outfit.pk %}">{{ item.outfit.name }}</a></td>
                <td style="text-align: right; padding: 8px;">{{ item.price_per_item|floatformat:2|intcomma }}</td>
                <td style="text-align: center; padding: 8px;">
                    {# ฟอร์มสำหรับอัปเดตจำนวน #}
                    <form action="{% url 'outfits:update_cart_item' item.outfit.id %}" method="post" style="display: flex; align-items: center; justify-content: center;">
                        {% csrf_token %}
                        {# แสดง input จำนวนจากฟอร์ม #}
                        {{ item.update_form.quantity }}
                        <button type="submit" class="button secondary-button tiny-button" style="margin-left: 5px;">อัปเดต</button> {# ใช้ class จาก CSS framework ของคุณ #}
                    </form>
                </td>
                 {# ราคารวมต่อรายการ (Quantity * Price per item) #}
                <td style="text-align: right; padding: 8px;">{{ item.total_price|floatformat:2|intcomma }}</td>
                <td style="text-align: center; padding: 8px;">
                    {# ฟอร์มสำหรับลบสินค้า #}
                    <form action="{% url 'outfits:remove_from_cart' item.outfit.id %}" method="post" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="button alert-button tiny-button" style="color:red;">ลบ</button> {# ใช้ class จาก CSS framework ของคุณ #}
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="border-top: 2px solid #ccc;">
                {# --- ปรับ colspan ให้ตรงกับจำนวนคอลัมน์ใหม่ --- #}
                <td colspan="4" style="text-align: right; padding: 8px;"><strong>ยอดรวม (ยังไม่รวมระยะเวลาเช่า):</strong></td>
                <td colspan="2" style="text-align: right; padding: 8px;"><strong>{{ total_cart_price|floatformat:2|intcomma }} บาท</strong></td>
            </tr>
        </tfoot>
    </table>

    <div style="margin-top: 20px; text-align: right;">
        <a href="{% url 'outfits:outfit-list' %}" class="button secondary-button" style="margin-right: 10px;">เลือกชุดต่อ</a> {# ปุ่มกลับไปเลือกของ #}
        <a href="{% url 'outfits:checkout' %}" class="button primary-button">ดำเนินการต่อ (Checkout)</a> {# ใช้ class จาก CSS framework ของคุณ #}
    </div>

{% else %}
    <p>ตะกร้าสินค้าของคุณว่างเปล่า</p>
    <a href="{% url 'outfits:outfit-list' %}" class="button primary-button">เลือกดูชุด</a>
{% endif %}

{% endblock %}