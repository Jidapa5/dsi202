{# --- ตัวอย่างใน order_detail.html --- #}
{% extends 'outfits/base.html' %}
{% load humanize %}

{% block title %}รายละเอียดคำสั่งเช่า #{{ order.id }}{% endblock %}

{% block content %}
<h2>รายละเอียดคำสั่งเช่า #{{ order.id }}</h2>
<p><strong>สถานะ:</strong> {{ order.get_status_display }}</p> {# ใช้ get_status_display #}
<p><strong>วันที่สั่ง:</strong> {{ order.created_at|date:"d/m/Y H:i" }}</p>

{# --- ข้อมูลลูกค้า --- #}
<h3>ข้อมูลลูกค้า</h3>
<p>{{ order.first_name }} {{ order.last_name }}</p>
<p>อีเมล: {{ order.email }}</p>
<p>โทร: {{ order.phone }}</p>
<p>ที่อยู่จัดส่ง: {{ order.address }}</p>

{# --- ช่วงเวลาเช่า --- #}
<h3>ช่วงเวลาเช่า</h3>
<p><strong>วันที่เริ่มเช่า:</strong> {{ order.rental_start_date|date:"d/m/Y" }}</p>
<p><strong>วันที่คืน:</strong> {{ order.rental_end_date|date:"d/m/Y" }}</p>
<p><strong>ระยะเวลา:</strong> {{ order.rental_duration_days }} วัน</p>

{# --- รายการสินค้า --- #}
<h3>รายการชุดที่เช่า</h3>
<table style="width:100%; border-collapse: collapse; margin-bottom: 15px;">
  <thead>
    <tr style="border-bottom: 1px solid #ccc;">
      <th style="text-align: left;">ชุด</th>
      <th style="text-align: center;">จำนวน</th>
      <th style="text-align: right;">ราคาต่อวัน</th>
      <th style="text-align: right;">ราคารวมต่อรายการ</th>
    </tr>
  </thead>
  <tbody>
    {% for item in order.items.all %}
      <tr>
        <td>{{ item.outfit.name }}</td>
        <td style="text-align: center;">{{ item.quantity }}</td>
        {# --- แสดงราคาต่อวันที่บันทึกไว้ --- #}
        <td style="text-align: right;">{{ item.price_per_day|floatformat:2|intcomma }}</td>
        {# --- แสดงราคารวมของรายการนี้ --- #}
        <td style="text-align: right;">{{ item.item_total_cost|floatformat:2|intcomma }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{# --- ข้อมูลการจัดส่งและชำระเงิน --- #}
<h3>การจัดส่งและชำระเงิน</h3>
{# <p><strong>ค่าจัดส่ง:</strong> {{ order.shipping_cost|floatformat:2|intcomma }} บาท</p> #}
<p><strong>ยอดรวมทั้งสิ้น:</strong> {{ order.total_amount|floatformat:2|intcomma }} บาท</p>
<p><strong>ชำระเงินแล้ว:</strong> {% if order.paid %}ใช่{% else %}ยังไม่ได้ชำระ{% endif %}</p>
<p><strong>วิธีชำระเงิน:</strong> {{ order.payment_method|default:"-" }}</p>
<p><strong>Payment ID:</strong> {{ order.payment_id|default:"-" }}</p>
<p><strong>เลขพัสดุ (ส่ง):</strong> {{ order.shipping_tracking_number|default:"-" }}</p>
<p><strong>เลขพัสดุ (คืน):</strong> {{ order.return_tracking_number|default:"-" }}</p>

{# --- ปุ่มดำเนินการ (ถ้ามี) --- #}
{% if order.status == 'pending' and not order.paid %}
  <a href="{% url 'outfits:payment_process' order.id %}" class="button primary-button">ไปที่หน้าชำระเงิน</a>
{% endif %}
{# เพิ่มปุ่ม แจ้งคืนสินค้า หรืออื่นๆ ตามสถานะ #}

<p style="margin-top: 20px;"><a href="{% url 'outfits:order_history' %}">&larr; กลับไปประวัติการเช่า</a></p>

{% endblock %}

{# --- ตัวอย่างใน order_history.html --- #}
{# (เพิ่มคอลัมน์ วันที่เริ่มเช่า, วันที่คืน ในตาราง) #}
<thead>
  <tr style="border-bottom: 2px solid #ccc;">
    <th style="text-align: left; padding: 8px;">เลขที่คำสั่งเช่า</th>
    <th style="text-align: left; padding: 8px;">วันที่สั่ง</th>
    <th style="text-align: left; padding: 8px;">วันที่เริ่มเช่า</th> {# <-- เพิ่ม #}
    <th style="text-align: left; padding: 8px;">วันที่คืน</th>     {# <-- เพิ่ม #}
    <th style="text-align: right; padding: 8px;">ยอดรวม</th>
    <th style="text-align: center; padding: 8px;">สถานะ</th>
    <th style="text-align: center; padding: 8px;">ดูรายละเอียด</th>
  </tr>
</thead>
<tbody>
  {% for order in orders %}
    <tr style="border-bottom: 1px solid #eee;">
      <td style="padding: 8px;">#{{ order.id }}</td>
      <td style="padding: 8px;">{{ order.created_at|date:"d/m/Y H:i" }}</td>
      <td style="padding: 8px;">{{ order.rental_start_date|date:"d/m/Y" }}</td> {# <-- เพิ่ม #}
      <td style="padding: 8px;">{{ order.rental_end_date|date:"d/m/Y" }}</td>   {# <-- เพิ่ม #}
      <td style="text-align: right; padding: 8px;">{{ order.total_amount|floatformat:2|intcomma }} บาท</td>
      <td style="text-align: center; padding: 8px;">{{ order.get_status_display }}</td>
      <td style="text-align: center; padding: 8px;">
        <a href="{% url 'outfits:order_detail' order.id %}" class="button secondary-button tiny-button">ดูรายละเอียด</a>
      </td>
    </tr>
  {% endfor %}
</tbody>