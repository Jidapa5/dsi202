{% extends 'outfits/base.html' %}
{% load static %}

{% block title %}แก้ไขโปรไฟล์ - {{ user.username }}{% endblock %}

{% block extra_head %}
<style>
    .profile-container { max-width: 600px; margin: 30px auto; background-color: #fff; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); }
    .profile-form h3 { margin-top: 25px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; color: var(--primary-color); font-size: 1.2em; }
    .profile-form h3:first-of-type { margin-top: 0; } /* แก้ไข selector */
    .form-field { margin-bottom: 15px; }
    .form-field label { display: block; margin-bottom: 5px; font-weight: 500; }
    /* --- ใช้ CSS class จาก forms.py --- */
    .form-input, .form-textarea, input[type="email"] { /* เพิ่ม email */
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 1rem;
        box-sizing: border-box; /* เพิ่ม box-sizing */
    }
    .form-textarea { resize: vertical; min-height: 80px;}
    .form-errors { color: #dc3545; font-size: 0.9em; margin-top: 5px; list-style: none; padding-left: 0;} /* เอา list style ออก */
    .profile-readonly p { margin-bottom: 5px; }
    /* --- CSS สำหรับ Alert (ควรย้ายไป styles.css) --- */
     .alert { border-radius: var(--border-radius); padding: 10px 15px; margin-bottom: 15px; border-left-width: 5px; border-left-style: solid; }
     .alert-success { background-color: #d4edda; border-color: #28a745; color: #155724;}
     .alert-error { background-color: #f8d7da; border-color: #dc3545; color: #721c24;}
     .alert-info { background-color: #d1ecf1; border-color: #17a2b8; color: #0c5460;}
     .alert-warning { background-color: #fff3cd; border-color: #ffc107; color: #856404;}
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <h2 style="text-align: center; margin-bottom: 25px;">แก้ไขโปรไฟล์ของคุณ</h2>

    {# แสดง Messages #}
    {% if messages %}
       <div class="messages-container" style="padding-bottom: 15px;">
            {% for message in messages %} <div class="alert alert-{{ message.tags }}">{{ message }}</div> {% endfor %}
        </div>
    {% endif %}

    {# --- แสดงข้อมูลที่แก้ไขไม่ได้ --- #}
    <div class="profile-readonly">
         <p><strong>ชื่อผู้ใช้ (Username):</strong> {{ user.username }} (ไม่สามารถแก้ไขได้)</p>
         <p><strong>วันที่เข้าร่วม:</strong> {{ user.date_joined|date:"d/m/Y" }}</p>
         <hr style="margin: 15px 0;">
    </div>

    {# --- ฟอร์มแก้ไข (รวม UserForm และ ProfileForm) --- #}
    <form method="post" class="profile-form">
        {% csrf_token %}

        <h3>ข้อมูลบัญชี</h3>
        {# --- Render ฟอร์ม user_form --- #}
        {% for field in user_form %}
            <div class="form-field">
                {{ field.label_tag }}
                {{ field }} {# ใช้ widget ที่กำหนดใน forms.py #}
                {% if field.errors %}<div class="form-errors">{{ field.errors }}</div>{% endif %}
                {% if field.help_text %}<p class="help-text">{{ field.help_text|safe }}</p>{% endif %}
            </div>
        {% endfor %}

        <h3>ข้อมูลติดต่อ / ที่อยู่สำหรับจัดส่ง</h3>
         {# --- Render ฟอร์ม profile_form --- #}
        {% for field in profile_form %}
             <div class="form-field">
                {{ field.label_tag }}
                {{ field }} {# ใช้ widget ที่กำหนดใน forms.py #}
                {% if field.errors %}<div class="form-errors">{{ field.errors }}</div>{% endif %}
                {% if field.help_text %}<p class="help-text">{{ field.help_text|safe }}</p>{% endif %}
            </div>
        {% endfor %}

        {# --- แสดง non-field errors (ถ้ามี) --- #}
        {% if user_form.non_field_errors %}
            <div class="form-errors">{{ user_form.non_field_errors }}</div>
        {% endif %}
         {% if profile_form.non_field_errors %}
            <div class="form-errors">{{ profile_form.non_field_errors }}</div>
        {% endif %}

        <button type="submit" class="button primary-button" style="width: 100%; padding: 12px; margin-top: 20px;">บันทึกการเปลี่ยนแปลง</button>
    </form>

     <p style="text-align: center; margin-top: 20px;">
         <a href="{% url 'password_change' %}">ต้องการเปลี่ยนรหัสผ่าน?</a>
     </p>
</div>
{% endblock %}